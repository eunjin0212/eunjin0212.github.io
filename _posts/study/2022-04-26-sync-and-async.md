---
layout: post
title: ë¹„ë™ê¸°ì™€ ë™ê¸° (ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ì–´ë–»ê²Œ ëŒì•„ê°€ëŠ”ê°€?)
subtitle: íŒŒë„ ëì´ ì—†ëŠ” JS
categories: Study
tags: [javascript, synchronouse, asynchronouse]
---

> ì‚¬ë‘í•˜ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ ëœ¯ì–´ë³´ì.

## ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—”ì§„ì˜ êµ¬ì¡°

ìë°”ìŠ¤í¬ë¦¼íŠ¸ ì—”ì§„ì€ ê°ê° í•œ ê°œì”© í˜¸ì¶œ ìŠ¤íƒì´ ìŒ“ì´ëŠ” **ì½œìŠ¤íƒ** ê³¼ ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•˜ëŠ” **ë©”ëª¨ë¦¬ í™** ì„ ê°–ëŠ”ë‹¤. í•˜ë‚˜ì”© ìˆëŠ” ì´ìœ ëŠ” **ì‹±ê¸€ìŠ¤ë ˆë“œ** ë°©ì‹ìœ¼ë¡œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì´ë‹¤.   
ì´ ì˜ë¯¸ëŠ” ë‘ ê°œ ì´ìƒì˜ í•¨ìˆ˜ë¥¼ ë™ì‹œì— ì‹¤í–‰ í•  ìˆ˜ ì—†ë‹¤ëŠ” ê²ƒì´ë‹¤. ê·¸ë˜ì„œ ì²˜ë¦¬ ì‹œê°„ì´ ê±¸ë¦¬ëŠ” taskë¥¼ ì‹¤í–‰ í•  ê²½ìš° **ë¸”ë¡œí‚¹ (ì‘ì—… ì¤‘ë‹¨)** ì´ ë°œìƒí•œë‹¤.

ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ëŸ°íƒ€ì„ì—ëŠ” (íŠ¹ì • ì–¸ì–´ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” í™˜ê²½) ì»¤ë„(node jsëŠ” ë¦¬ë²„ë¸Œ, ë¸Œë¼ìš°ì €ëŠ” Wep API)ê³¼ ì´ë²¤íŠ¸ ë£¨í”„, ì½œë°± íê°€ ìˆë‹¤.

![javascript_runtime](/assets/images/posts/javascript_runtime.png)

Event loopëŠ” ì²˜ë¦¬í•  taskê°€ ì—†ìœ¼ë©´ ì ìê³  ìˆë‹¤ê°€ ì²˜ë¦¬í•  taskê°€ ìƒê¸°ë©´ ì´ë¥¼ ì½œìŠ¤íƒì— ì˜¬ë ¤ì£¼ëŠ” ì—­í• ì„ í•œë‹¤. ì½œìŠ¤íƒì´ ë¹„ì–´ìˆëŠ”ì§€ ê³„ì† í™•ì¸í•˜ê³  ë‹¤ìŒ taskë¥¼ ê°€ì§€ê³  ì˜¨ë‹¤.

### ë¹„ë™ê¸°

ë¹„ë™ê¸°ë€? í˜„ì¬ ì‹¤í–‰ì¤‘ì¸ ì½”ë“œê°€ ì™„ë£Œí•˜ì§€ ì•Šì•„ë„ ë‹¤ìŒ ì½”ë“œë¡œ ë„˜ì–´ê°„ë‹¤. ì‹¤í–‰ taskê°€ ì™„ë£Œí•˜ì§€ ì•Šì•„ë„ ë‹¤ìŒ taskë¡œ ë„˜ì–´ê°€ê¸° ë•Œë¬¸ì— ë¸”ë¡œí‚¹ì´ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤. í•˜ì§€ë§Œ ì‹¤í–‰ ìˆœì„œê°€ ë³´ì¥ë˜ì§€ëŠ” ì•ŠëŠ”ë‹¤.

ì—¬ê¸°ì„œ ë§í•˜ëŠ” í˜„ì¬ ì‹¤í–‰ì¤‘ì¸ ì½”ë“œëŠ” ë„¤íŠ¸ì›Œí¬ I/Oë‚˜ í•˜ë“œë””ìŠ¤í¬ë¥¼ ì“°ëŠ” I/Oë¥¼ ë§í•œë‹¤. (í˜¹ì€ ê·¸ ë’¤ì— ì˜¤ëŠ” ì½”ë“œë“¤) ì¼ë°˜ í•¨ìˆ˜ ì½”ë“œëŠ” ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰ ì‹œí‚¨ ë’¤ ì½œìŠ¤íƒì„ ë¹ ì ¸ë‚˜ê°„ë‹¤. ë„¤íŠ¸ì›Œí¬ I/Oë‚˜ í•˜ë“œë””ìŠ¤í¬ë¥¼ ì“°ëŠ” I/O ì²˜ë¦¬ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ ëŸ°íƒ€ì„ í™˜ê²½ (ë¸Œë¼ìš°ì €, Node.js)ì—ì„œ ëŒ€ì‹  ì²˜ë¦¬í•´ì¤€ë‹¤. ì •í™•íˆëŠ” ìŠ¤íƒì´ ì»¤ë„ì— ìœ„ì„í•´ì¤€ë‹¤. ìœ„ì„ë°›ì€ ì»¤ë„ì€ ë™ì‘ì„ ìˆ˜í–‰ í•œ í›„ Task Queueì— ë‹´ëŠ”ë° í˜¸ì¶œì— ë”°ë¼ ë‹´ê¸°ëŠ” Queueê°€ ë‹¤ë¥´ë‹¤.

**Microtask Queue** ì— ë‹´ê¸°ëŠ” ì• ë“¤ì€ ë¹„ë™ê¸° í˜¸ì¶œì„ ë„˜ê²¨ë°›ëŠ”ë‹¤ (`promise`, `asnyc await`, `nextTick`, `queueMicrotask`) ìš°ì„ ìˆœìœ„ê°€ ê°€ì¥ ë†’ë‹¤.   
**Macrotask Queue** ì— ë‹´ê¸°ëŠ” ì• ë“¤ì€ `setTimeout`, `setInterval`, `setImmediateê°€` ìˆë‹¤.   
ì»¤ë„ì´ ì½”ë“œë¥¼ ìˆ˜í–‰í•˜ëŠ” ë™ì•ˆ ì½œìŠ¤íƒ ë‚´ ì½”ë“œë“¤ì´ í•  ì¼ì„ ë‹¤ í•˜ê³  ì½œìŠ¤íƒì—ì„œ ì œê±° ë˜ì–´ ì½œìŠ¤íƒì´ ë¹„ì—ˆë‹¤. ê·¸ëŸ¬ë©´ ì´ë²¤íŠ¸ë£¨í”„ëŠ” Queueì—ì„œ ìš°ì„ ìˆœìœ„(ğŸ¥‡ Microtask Queue)ëŒ€ë¡œ ì½”ë“œë¥¼ êº¼ë‚´ì™€ ì½œìŠ¤íƒì— ë‹´ê¸´ë‹¤.

> setTimeoutì´ ì •í™•í•˜ì§€ ì•Šì€ ì´ìœ ëŠ” ì´ í”Œë¡œìš° ë•Œë¬¸ì´ë‹¤. setTimeout ë©”ì„œë“œëŠ” ì»¤ë„ì—ì„œ ì²˜ë¦¬í•˜ëŠ” ë¹„ë™ê¸° ë©”ì„œë“œ ì¸ë° ì»¤ë„ì—ì„œ ì œ ì‹œê°„ì— ì²˜ë¦¬ í›„ Macrotask Queueì— ë‹´ê²¨ë„ ì½œìŠ¤íƒì— ì½”ë“œê°€ ì•„ì§ ìˆìœ¼ë©´ ì½œìŠ¤íƒì´ ëª¨ë‘ ë¹„ì›Œì§ˆ ë•Œ ê¹Œì§€ ê¸°ë‹¤ë ¤ì•¼ í•˜ë¯€ë¡œ ì •í™•í•˜ì§€ ì•Šë‹¤ê³  í•˜ëŠ” ê²ƒì´ë‹¤. ë˜í•œ ì‹¤í–‰ ìˆœì„œê°€ ë³´ì¥ ë˜ì§€ ì•ŠëŠ” ì´ìœ ë„ ì´ ê²ƒì´ë‹¤.

### ë™ê¸°

ë™ê¸°ë€? í˜„ì¬ ì‹¤í–‰ì¤‘ì¸ ì½”ë“œë¥¼ ëª¨ë‘ ì™„ë£Œ í•´ì•¼ ë‹¤ìŒ ì½”ë“œë¡œ ë„˜ì–´ê°„ë‹¤. ëŒ€ë¶€ë¶„ì˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œëŠ” ë™ê¸°ë¡œ ì‹¤í–‰ëœë‹¤. ì´ìœ ëŠ” ì•ì„œ ë§í•œ ì‹±ê¸€ìŠ¤ë ˆë“œ ë°©ì‹ìœ¼ë¡œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì´ë‹¤. ì´ë•Œ taskê°€ ì˜¤ë˜ê±¸ë¦¬ê²Œ ë˜ë©´ ì‚¬ìš©ì ì¸í„°ë ‰ì…˜ì´ ì—†ëŠ” ë¸”ë¡œí‚¹ ìƒíƒœê°€ ëœë‹¤. ì›í™œí•œ UX ë¥¼ ì œê³µí•˜ê¸° ìœ„í•´ì„  ë¸”ë¡œí‚¹ ë˜ëŠ” ì½”ë“œë¥¼ ì§€ì–‘í•˜ì.

## ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ ë¹„ë™ê¸°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ê³¼ì •

![js_queue](/assets/images/posts/js_queue.gif)

1. ì½”ë“œë¥¼ ì½ëŠ”ë‹¤.
2. ì¼ë°˜ í•¨ìˆ˜ë¼ë©´(task1)? ê·¸ëƒ¥ ì½œìŠ¤íƒì— ìŒ“ì´ê³  ìˆœì„œëŒ€ë¡œ ì‹¤í–‰í•˜ê³  ì‚´í–‰ì´ ëë‚˜ë©´ ì½œìŠ¤íƒì—ì„œ ì œê±°í•œë‹¤. (LIFO êµ¬ì¡°)
3. ì—¬ê¸°ì— ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬ í•´ì•¼í•  ì½”ë“œ(task2)ê°€ ìˆë‹¤ë©´? ì»¤ë„(Web API)ì— ìœ„ì„í•œë‹¤.
4. ë‹¤ìŒ í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œí‚¨ë‹¤. ì´ë•Œ ìš°ì„ ìˆœìœ„ëŠ” Microtask Queueê°€ ë¨¼ì €ì´ê³  Macrotask QueueëŠ” ê·¸ ë‹¤ìŒì´ë‹¤.
5. Microtask Queue ê°€ ëë‚˜ë©´ Macrotask Queueì— ìˆëŠ” task ë“¤ì´ ì‹¤í–‰ëœë‹¤

```Javascript
// ì½˜ì†”ì— ë‚˜ì˜¬ ìˆœì„œë¥¼ ì˜ˆì¸¡í•´ë³´ì 
function A() {
  return new Promise((res, rej) => {
    console.log("A'") // 3ë²ˆ ì½˜ì†”ì— ì°íŒë‹¤
    res("A")
  })
}

function B() {
  setTimeout(() => {
    console.log("B")
  }, 0)
}

function C() {
  return new Promise((res, rej) => {
    setTimeout(() => {
      console.log("C'")
      res("C")
    }, 0)
  })
}

async function main() { // ë©”ì¸ í•¨ìˆ˜ë„ ë¹„ë™ê¸°ë¡œ ì‹¤í–‰ë¨.
  console.log("START") // 2ë²ˆ ë©”ì¸ í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ê³  ì‹¤í–‰í•˜ë©´ì„œ ì½˜ì†”ì— ì°í•œë‹¤.
  console.log('console', await A()) // await ëŠ” promiseê°€ ì´í–‰ë  ë•Œ ê¹Œì§€ ê¸°ë‹¤ë¦°ë‹¤. ì½œìŠ¤íƒì— ìˆëŠ” ì‘ì—…ë“¤ì´ ëë‚˜ë©´ ì°¨ë ˆëŒ€ë¡œ ì‹¤í–‰ëœë‹¤ 5ë²ˆ
  B() // Bê°€ ì‹¤í–‰ì´ ë˜ì§€ë§Œ setTimeout ë©”ì†Œë“œë¡œ Macro queueì— ë‹´ê²¨ì„œ ì½œìŠ¤íƒê³¼ Micro queueê°€ ì‹¤í–‰ì´ ë‹¤ ëë‚˜ë©´ ë‚˜ì˜¨ë‹¤.
  C() // Cë„ Bì™€ ë§ˆì°¬ê°€ì§€.
  await A() // promiseê°€ ì´í–‰ë˜ë©´ ì°íŒë‹¤.
  console.log("END") // ë©”ì¸ í•¨ìˆ˜ëŠ” ë¹„ë™ê¸° ì´ë¯€ë¡œ ê¸°ë‹¤ë¦°ë‹¤.
}

console.log("SCRIPT START") // 1ë²ˆ íŒŒì¼ì´ ì—´ë¦¬ë©´ ê°€ì¥ ë¨¼ì € ì½œìŠ¤íƒì—ì„œ ì‹¤í–‰ëœë‹¤.
main()
console.log("SCRIPT END") // mainì„ ëë‚´ê³  4ë²ˆ í˜¸ì¶œ ëœë‹¤.
// ì‹¤í–‰ ìˆœì„œ SCRIPT START > START > A' > SCRIPT END > console A > A' > END > B > C'
```

## reference

- [Task Queueë§ê³  ë‹¤ë¥¸ íê°€ ë” ìˆë‹¤ê³ ?](https://velog.io/@titu/JavaScript-Task-Queue%EB%A7%90%EA%B3%A0-%EB%8B%A4%EB%A5%B8-%ED%81%90%EA%B0%80-%EB%8D%94-%EC%9E%88%EB%8B%A4%EA%B3%A0-MicroTask-Queue-Animation-Frames-Render-Queue)
- [ìë°”ìŠ¤í¬ë¦½íŠ¸ ë™ì‘ ì›ë¦¬ì™€ ë¹„ë™ê¸° ì²˜ë¦¬ì˜ ì›ë¦¬ (Event Loop, Task Queue)](https://velog.io/@chojs28/%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8-%EB%8F%99%EC%9E%91-%EC%9B%90%EB%A6%AC%EC%99%80-%EB%B9%84%EB%8F%99%EA%B8%B0-%EC%B2%98%EB%A6%AC%EC%9D%98-%EC%9B%90%EB%A6%AC-Event-Loop-Task-Queue)
- [ìë°”ìŠ¤í¬ë¦½íŠ¸ ëŸ°íƒ€ì„](https://beomy.github.io/tech/javascript/javascript-runtime/)
- [ìë°”ìŠ¤í¬ë¦½íŠ¸ INFO](https://ko.javascript.info/event-loop)
- [Node.js ì´ë²¤íŠ¸ ë£¨í”„(Event Loop) ìƒ…ìƒ…ì´ ë¶„ì„í•˜ê¸°](https://www.korecmblog.com/node-js-event-loop/)
